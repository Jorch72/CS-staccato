@using staccato
@section scripts {
    <script src="/js/home.js" type="text/javascript"></script>
}
@section navigation {
<ul class="nav">
    <li><a href="#upload" data-toggle="modal">Upload</a></li>
</ul>
}

<div class="row">
    <div class="span6">
        <h2>Queue <small data-bind="visible: !groupPlay()">(Not in group)</small></h2>
        <table class="table table-condensed">
            <tbody data-bind="foreach: queue, css: { 'no-group': !groupPlay() }">
                <tr>
                    <td><a class="queue-item" data-bind="text: Name, click: $parent.changeSong, attr: { title: Name }, css: { 'user-added': UserAdded }" href="#"></a></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="span6">
        <h2>Now Playing</h2>
        <audio id="player" autoplay controls preload></audio>
        <p class="lead" data-bind="text: name, attr: { title: name }"></p>
        <div class="row">
            <span class="span2">
                <a data-bind="attr: { href: download }" class="btn btn-success" style="display: block;">Download</a>
            </span>
            <span class="span2">
                <a class="btn btn-warning input-block-level" data-bind="click: requestSkip, visible: groupPlay() && !skipRequested()" href="#">Vote to Skip</a>
                <a class="btn btn-warning input-block-level" 
                    data-bind="visible: groupPlay() && skipRequested(), text: skipsRequested() + '/' + skipsRequired()" href="#" disabled="disabled"></a>
            </span>
            <span class="span2">
                <a class="btn btn-info input-block-level" data-bind="visible: !groupPlay(), click: getNowPlaying" href="#">Rejoin Group</a>
                <div data-bind="visible: groupPlay() && skipsRequested() != 0 && !skipRequested()" style="margin-top: 4px;">
                    <strong>Skip? </strong><span data-bind="text: skipsRequested() + '/' + skipsRequired() + ' votes'"></span>
                </div>
            </span>
        </div>
        <h2>Song Search</h2>
        <form class="row" data-bind="submit: search">
            <div class="span4">
                <input type="text" class="input-block-level" placeholder="Search Terms" data-bind="value: searchTerms" />
            </div>
            <div class="span2">
                <input type="submit" class="btn btn-primary input-block-level" value="Search" style="width: 100%;" />
            </div>
        </form>
        <div data-bind="visible: announcement" class="alert"><strong>Notice: </strong><span data-bind="text: announcement"></span></div>
    </div>
</div>

<table class="table table-condensed" style="margin-top: 10px;" id="searchTable">
    <tbody data-bind="foreach: searchResults">
        <tr>
            <td style="vertical-align: middle; width: 80%;"><a href="#" data-bind="text: Name, click: $parent.changeSong"></a></td>
            <td><a href="#" class="btn btn-info" data-bind="attr: { disabled: !CanRequest }, click: $parent.requestSong">Request</a></td>
            <td><a data-bind="attr: { href: Download }" class="btn btn-success">Download</a></td>
        </tr>
    </tbody>
</table>
<div data-bind="visible: hasSearched">
    <div data-bind="visible: searchResults().length == 0" class="muted">No results</div>
    <div data-bind="visible: totalPages() > 1" class="pagination">
        <ul>
            <li data-bind="css: { disabled: page() == 1 }"><a href="#" data-bind="click: previousPage">«</a></li>
            <!-- ko foreach: pages -->
            <li data-bind="css: { active: $parent.page() == $data }"><a href="#" data-bind="text: $data, click: $parent.specificPage"></a></li>
            <!-- /ko -->
            <li data-bind="css: { disabled: page() == totalPages() }"><a href="#" data-bind="click: nextPage">»</a></li>
        </ul>
    </div>
</div>
<div class="modal hide fade" id="upload">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>Upload a Song</h3>
    </div>
    <div class="modal-body">
        <div class="alert alert-error" data-bind="visible: uploadError">
            <strong>Error: </strong><span data-bind="text: uploadError"></span>
        </div>
        <div class="alert alert-success" data-bind="visible: uploadSuccess">
            <strong>Success! </strong>Thanks for expanding our library!</span>
        </div>
        <ul class="nav nav-tabs">
            <li class="active"><a data-toggle="tab" href="#mp3">MP3</a></li>
            <li><a data-toggle="tab" href="#youtube">YouTube</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active" id="mp3">
                <div class="well upload-well" id="upload-target"
                    data-bind="text: fileName() == '' ? 'Drag and drop your mp3 file here' : ( uploadReady() ? 'Ready to upload ' + fileName() : 'Preparing ' + fileName() )">
                </div>
                <p>Please make sure your file uses the "Artist Name - Song Title.mp3" naming format.</p>
            </div>
            <div class="tab-pane" id="youtube">
                Uploading YouTube videos is still in development and not yet available.
            </div>
        </div>
    </div>
    <div class="modal-footer">
      <i class="icon-refresh" data-bind="visible: uploading"></i>
      <a href="#" class="btn" data-dismiss="modal" data-bind="enable: !uploading(), attr: { disabled: uploading() }">Close</a>
      <a href="#" class="btn btn-primary" data-bind="click: uploadSong, enable: uploadReady() && !uploading(), attr: { disabled: !uploadReady() || uploading() }">Upload</a>
    </div>
</div>